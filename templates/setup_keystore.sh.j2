#!/bin/bash

export ES_HOME={{ elasticsearch_extract_dir }}/elasticsearch
export ES_PATH_CONF={{ elasticsearch_conf_dir }}

KEYSTORE_FILE={{ elasticsearch_conf_dir }}/elasticsearch.keystore

if [ ! -f $KEYSTORE_FILE ]; then
    /opt/elasticsearch/bin/elasticsearch-keystore create
fi

echo "{{ elasticsearch_cert_password }}" | {{ elasticsearch_extract_dir }}/elasticsearch/bin/elasticsearch-keystore add -x -f xpack.security.transport.ssl.keystore.secure_password
echo "{{ elasticsearch_cert_password }}" | {{ elasticsearch_extract_dir }}/elasticsearch/bin/elasticsearch-keystore add -x -f xpack.security.transport.ssl.truststore.secure_password
echo "{{ elasticsearch_bootstrap_password }}" | {{ elasticsearch_extract_dir }}/elasticsearch/bin/elasticsearch-keystore add -x -f bootstrap.password